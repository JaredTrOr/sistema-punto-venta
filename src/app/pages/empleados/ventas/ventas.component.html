<app-navbar-empleados></app-navbar-empleados>

<section class="main-container">

    <!--Contenedor de ventas-->
    <div class="venta-container">
        <div class="carrito-venta">
            <!--Tabla de de productos, carrito de compra-->
            <table class="table">
                <thead>
                    <th>#</th>
                    <th>Artículo</th>
                    <th>Total</th>
                </thead>

                <tbody *ngIf="carritoProductos.length">
                    <tr *ngFor="let producto of carritoProductos">
                        <td>
                            {{ producto.cantidad }}
                            <!-- <button (click)="restarProducto(producto)" class="control-buttons">-</button> 
                            <button (click)="sumarProducto(producto)" class="control-buttons">+</button> -->
                        </td>
                        <td class="cursor" (click)="abrirModal(producto)">{{ producto.nombreProducto }}</td>
                        <td>${{ producto.cantidad * producto.importe }}</td>
                        <td (click)="eliminarProducto(producto.idProducto)" class="quitar-carrito"><i class="bi bi-trash"></i></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div *ngIf="!carritoProductos.length" class="empty-card">
            <div>
                <i class="bi bi-basket2-fill disabled-color cart-icon-disabled"></i>
                <p class="disabled-color">Sin productos agregados</p>
            </div>
        </div>

        <!--Despliegue del total, botones de realizar compra y limpiar-->
        <div class="despliegue-total">
            <div class="cantidad-precio">
                <h4 class="categoria">{{ getTotalProductos() || '-' }}</h4>
                <h4>Total: ${{ getTotal() || '-' }}</h4>
            </div>

            <div class="botones-total">
                <button [class.disabled]="!carritoProductos.length" (click)="onClickCompra()" class="btns btn-pagar">Pagar</button>
                <button [class.disabled]="!carritoProductos.length" (click)="limpiarCarrito()" class="btns btn-limpiar">
                    <i class="white bi bi-x-lg"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!--Imágen para la carga de productos-->
    <div *ngIf="loadingData" class="text-center">
        <img src="./assets/images/loading_image.gif" alt="Imagen de cargar">
        <h2>Cargando productos...</h2>
    </div>

    <!--Listado de productos-->
    <div *ngIf="!loadingData" class="productos-container">
        <!--Input de busqueda de texto-->
        <div class="inputs-container">
            <select [(ngModel)]="categoriaSeleccionada" class="filtro-categoria" name="" id="">
                <option value="todos">Todos</option>
                <option *ngFor="let categoria of categorias" value="{{ categoria.descripcion }}">{{ categoria.descripcion }}</option>
            </select>
            <select [(ngModel)]="ordenarPorSeleccionado" class="filtro-categoria" name="" id="">
                <option *ngFor="let item of ordenarPor" value="{{ item }}">{{ item }}</option>
            </select>
            <input [(ngModel)]="busquedaTexto" type="text" class="buscador" placeholder="Buscar por nombre">
        </div>

        <div class="fakiu mt-5">
            <p class="venta-title">Categoría &gt; {{ categoriaSeleccionada }}</p>

            <div class="box-container">
                <div (click)="agregarProducto(producto)" *ngFor="let producto of filtrar()" class="box">
                    <!-- <h3>ID: {{ producto.idProductoNumerico ? producto.idProductoNumerico : producto.idProducto }}</h3> -->
                     <div></div>

                    <div class="box-body">
                        <p class="nombre-producto">{{ producto.descripcion }}</p>
                        <p class="nombre-producto mt-2">$ {{ producto.precio }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

 <!-- Modal -->
 <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
        <div class="modal-header">

        <input 
            [(ngModel)]="numerosDisplay" 
            type="number" 
            id="input-numbers-modal" 
            placeholder="Ingrese la cantidad" 
            class="input-numbers" 
            disabled
        >
        </div>

        <div class="modal-body numbers-grid">
            <div *ngFor="let numero of numerosTecladoProductos" (click)="escribirNumeros(numero)">{{ numero }}</div>
            <div class="cero" (click)="escribirNumeros(0)">0</div>
            <div (click)="borrarNumeros()" class="borrar"><i class="bi bi-arrow-left white"></i></div>
        </div>

        <div class="modal-footer">
            <button type="button" class="btns btn-danger btn btn-borrar" data-bs-dismiss="modal"><i class="white bi bi-x-lg"></i></button>
            <button (click)="guardarCambios()" data-bs-dismiss="modal" type="button" class="btns btn btn-guardar"><i class="white bi bi-check2"></i></button>
        </div>
    </div>
    </div>
</div>

 <div class="modal fade" id="modalPago" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

        <div class="modal-body p-5">
            <div>
                <h3>Total:</h3>
            
                <input 
                    type="number" 
                    id="input-numbers-modal" 
                    placeholder="{{ getTotal() }}" 
                    class="input-numbers" 
                    disabled
                >
            </div>
            <br>
            <div>
                <h3>Recibido:</h3>
                <input 
                    [(ngModel)]="recibido" 
                    type="number" 
                    minlength="1"
                    id="input-numbers-modal" 
                    placeholder="Escriba la cantidad" 
                    class="input-numbers" 
                >
            </div>
            <br>
            <h3>Cambio: $ {{ calcularCambio() }} </h3>
            
        </div>

        <div class="modal-footer">
            <button type="button" class="btns btn-cancel-modal" data-bs-dismiss="modal"><i class="white bi bi-arrow-left"></i></button>
            <button (click)="realizarCompra()" data-bs-dismiss="modal" type="button" class="btns btn-realizar-compra">
                <i class="white bi bi-check2"></i>
            </button>
        </div>
    </div>
    </div>
</div>